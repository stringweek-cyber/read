<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¬ê²½ì´ì˜ ë…ì„œí†µì¥</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Jua Font) -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body {
            font-family: 'Jua', sans-serif;
            background-color: #FFF9C4; /* ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
            -webkit-tap-highlight-color: transparent;
        }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #FBC02D; border-radius: 10px; }

        /* ë™ì „ ìŠ¤íƒ€ì¼ */
        .coin {
            width: 24px;
            height: 24px;
            background-color: #FFD54F;
            border: 2px solid #FFB300;
            border-radius: 50%;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #8D6E63;
            margin-bottom: -10px; /* ë™ì „ ê²¹ì¹˜ê¸° */
            position: relative;
            z-index: 1;
            transition: transform 0.2s;
        }
        .coin:hover { transform: scale(1.2) translateY(-5px); z-index: 10; }
        .coin::before { content: 'â‚©'; }
        
        /* ìŠ¤í˜ì…œ ë™ì „ (ì–´ë ¤ìš´ ì±…) */
        .coin.special {
            background-color: #FFAB00;
            border-color: #E65100;
            color: #FFF;
        }

        /* ë‚ ì§œ ì„ íƒ íš¨ê³¼ */
        .date-active {
            background-color: #FFF59D;
            border-color: #FBC02D;
            transform: scale(1.05);
        }

        /* ì›”ê°„ ë‹¬ë ¥ ê·¸ë¦¬ë“œ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        /* ë§í’ì„  */
        .bubble {
            position: relative;
            background: #ffffff;
            border-radius: .4em;
        }
        .bubble:after {
            content: '';
            position: absolute;
            left: 0; top: 50%;
            width: 0; height: 0;
            border: 10px solid transparent;
            border-right-color: #ffffff;
            border-left: 0;
            margin-top: -10px; margin-left: -10px;
        }

        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ */
        .checkbox-wrapper input:checked + div {
            background-color: #FBC02D;
            border-color: #F57F17;
        }
        .checkbox-wrapper input:checked + div svg {
            display: block;
        }
    </style>
</head>
<body class="flex justify-center items-start min-h-screen bg-yellow-50">

    <!-- ëª¨ë°”ì¼ ì•± ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-md h-[100vh] sm:h-[90vh] sm:mt-8 bg-white sm:rounded-3xl shadow-2xl flex flex-col overflow-hidden relative border-4 border-yellow-200">
        
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="bg-yellow-400 p-4 pt-6 rounded-b-[2rem] shadow-md z-10 flex flex-col items-center justify-center shrink-0">
            <h1 class="text-3xl text-white drop-shadow-md tracking-wider flex items-center gap-2">
                <i class="fas fa-book-reader text-yellow-100"></i>
                ì¬ê²½ì´ì˜ ë…ì„œí†µì¥
            </h1>
            <div class="mt-3 flex gap-4 text-white text-sm font-medium bg-yellow-500 bg-opacity-50 px-4 py-1 rounded-full">
                <span>ëˆ„ì  ë™ì „: <span id="total-books" class="text-yellow-100 text-lg">0</span>ê°œ</span>
                <span>|</span>
                <span>ë‹¤ìŒ ì„ ë¬¼ê¹Œì§€: <span id="next-goal" class="text-yellow-100 text-lg">50</span>ê°œ</span>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <main class="flex-1 overflow-y-auto p-4 space-y-4">
            
            <!-- ì£¼ê°„ ë‹¬ë ¥ ë° ë™ì „ ì˜ì—­ -->
            <section class="bg-white p-3 rounded-3xl border-2 border-yellow-100 shadow-sm">
                <div class="flex justify-between items-center mb-2 px-1">
                    <h2 class="text-lg text-gray-700 font-medium"><i class="fas fa-calendar-week mr-2 text-yellow-500"></i>ì´ë²ˆ ì£¼ ë…ì„œ ê¸°ë¡</h2>
                    <button onclick="openMonthlyCalendar()" class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-lg hover:bg-gray-200 transition">ì „ì²´ ë‹¬ë ¥ ë³´ê¸°</button>
                </div>
                <div id="weekly-calendar" class="flex justify-between gap-1">
                    <!-- JSë¡œ ì£¼ê°„ ë‹¬ë ¥ ë° ë™ì „ ë Œë”ë§ -->
                </div>
            </section>

            <!-- ì±… ê¸°ë¡ ì˜ì—­ -->
            <section class="bg-blue-50 p-5 rounded-3xl border-2 border-blue-100 shadow-sm">
                <!-- ìˆ˜ì •ë¨: font-bold -> font-medium -->
                <h2 class="text-lg text-blue-600 font-medium mb-3 flex items-center gap-2">
                    <i class="fas fa-pencil-alt"></i> <span id="selected-date-display">ì˜¤ëŠ˜</span> ì½ì€ ì±… ê¸°ë¡í•˜ê¸°
                </h2>
                
                <div class="mb-4">
                    <input type="text" id="book-input" class="w-full bg-white p-3 rounded-xl border border-blue-200 focus:outline-none focus:border-blue-400 transition mb-2" placeholder="ì±… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key === 'Enter') saveBook()">
                    
                    <!-- 2ë°° ì ë¦½ ì²´í¬ë°•ìŠ¤ -->
                    <label for="double-coin-check" class="checkbox-wrapper flex items-center gap-2 cursor-pointer select-none bg-white p-2 rounded-xl border border-blue-100 hover:bg-blue-50 transition">
                        <input type="checkbox" id="double-coin-check" class="opacity-0 absolute w-0 h-0">
                        <div class="w-6 h-6 border-2 border-gray-300 rounded-lg flex items-center justify-center bg-gray-50 transition-colors shrink-0">
                            <svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <span class="text-gray-600 font-medium text-sm">ì–´ë ¤ìš´ ì±…ì´ì—ˆë‚˜ìš”? (ë™ì „ 2ê°œ! ğŸª™ğŸª™)</span>
                    </label>
                </div>

                <button onclick="saveBook()" class="w-full bg-blue-400 hover:bg-blue-500 text-white py-3 rounded-xl shadow-md transition active:scale-95 font-medium text-lg tracking-widest">
                    ì €ê¸ˆí†µì— ë„£ê¸° ğŸ’°
                </button>
                
                <!-- ì„ íƒëœ ë‚ ì§œì˜ ì±… ëª©ë¡ -->
                <div class="mt-4 bg-white p-3 rounded-xl border border-blue-100 h-32 overflow-y-auto">
                    <!-- ìˆ˜ì •ë¨: ë¬¸êµ¬ ë³€ê²½ ë° font-bold -> font-medium -->
                    <h3 class="text-sm text-gray-500 font-medium mb-2">ğŸ“œ ë…ì„œí†µì¥ ê¸°ë¡</h3>
                    <ul id="daily-book-list" class="space-y-2 text-gray-700">
                        <!-- JSë¡œ ì±… ëª©ë¡ ë Œë”ë§ -->
                        <li class="text-gray-400 text-center py-4">ì•„ì§ ê¸°ë¡ëœ ì±…ì´ ì—†ì–´ìš”.</li>
                    </ul>
                </div>
            </section>

        </main>

        <!-- ìºë¦­í„° í‘¸í„° -->
        <footer class="shrink-0 bg-white/90 backdrop-blur-sm p-3 border-t border-yellow-100 flex items-center gap-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
            <div class="relative shrink-0">
                <!-- SVG ì§ì ‘ ì‚½ì… (ì´ë¯¸ì§€ ê¹¨ì§ ë°©ì§€) -->
                <div class="w-16 h-16 rounded-full border-4 border-yellow-300 bg-yellow-100 shadow-md overflow-hidden relative">
                    <svg viewBox="0 0 100 100" class="w-full h-full">
                        <rect width="100" height="100" fill="#FFECB3"/>
                        <path d="M50 20 C30 20 15 35 15 55 C15 75 30 90 50 90 C70 90 85 75 85 55 C85 35 70 20 50 20" fill="#FFCC80"/>
                        <path d="M15 55 C15 30 30 10 50 10 C70 10 85 30 85 55 C85 45 80 25 50 25 C20 25 15 45 15 55" fill="#5D4037"/>
                        <circle cx="35" cy="50" r="4" fill="#3E2723"/>
                        <circle cx="65" cy="50" r="4" fill="#3E2723"/>
                        <circle cx="25" cy="60" r="5" fill="#FFAB91" opacity="0.6"/>
                        <circle cx="75" cy="60" r="5" fill="#FFAB91" opacity="0.6"/>
                        <path d="M35 65 Q50 75 65 65" stroke="#3E2723" stroke-width="3" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
            </div>
            <div class="bubble bg-white border border-gray-200 p-3 shadow-sm flex-1 text-sm text-gray-600 animate-bounce">
                <span id="mascot-message">ë§¤ì¼ ë§¤ì¼ ì±…ì„ ì½ê³  ë™ì „ì„ ëª¨ì•„ë´!</span>
            </div>
        </footer>

    </div>

    <!-- ìˆ˜ì •ëœ ì›”ê°„ ë‹¬ë ¥ ëª¨ë‹¬ (ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì‹) -->
    <div id="monthly-calendar-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <!-- max-h-[90vh] overflow-y-auto ì¶”ê°€í•˜ì—¬ ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ëª¨ë‹¬ ì „ì²´ê°€ ìŠ¤í¬ë¡¤ë˜ë„ë¡ ìˆ˜ì • -->
        <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl relative max-h-[90vh] overflow-y-auto border-4 border-yellow-200">
            
            <button onclick="closeMonthlyCalendar()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10 bg-white rounded-full p-1 shadow-sm">
                <i class="fas fa-times fa-lg"></i>
            </button>
            
            <div class="p-5 pb-8"> <!-- ë‚´ë¶€ íŒ¨ë”© ë° í•˜ë‹¨ ì—¬ë°± í™•ë³´ -->
                
                <!-- ë‹¬ë ¥ í—¤ë” -->
                <div class="flex justify-between items-center mb-4 mt-2 px-2">
                    <button onclick="changeMonth(-1)" class="text-gray-400 hover:text-yellow-500 p-2"><i class="fas fa-chevron-left fa-lg"></i></button>
                    <h2 id="calendar-title" class="text-2xl text-gray-700 font-bold"></h2>
                    <button onclick="changeMonth(1)" class="text-gray-400 hover:text-yellow-500 p-2"><i class="fas fa-chevron-right fa-lg"></i></button>
                </div>
                
                <!-- ìš”ì¼ í—¤ë” -->
                <div class="grid grid-cols-7 text-center mb-2 text-gray-500 text-sm font-bold">
                    <div class="text-red-400">ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div class="text-blue-400">í† </div>
                </div>

                <!-- ë‚ ì§œ ê·¸ë¦¬ë“œ -->
                <div id="calendar-days" class="calendar-grid mb-6">
                    <!-- JSë¡œ ë Œë”ë§ -->
                </div>

                <!-- ë²”ë¡€ -->
                <div class="flex justify-center items-center gap-2 text-xs text-gray-500 bg-gray-50 p-3 rounded-xl mb-6 border border-gray-100">
                    <span>ì¡°ê¸ˆ</span>
                    <div class="w-4 h-4 rounded bg-yellow-100 border border-yellow-200"></div>
                    <div class="w-4 h-4 rounded bg-yellow-300 border border-yellow-400"></div>
                    <div class="w-4 h-4 rounded bg-yellow-500 border border-yellow-600"></div>
                    <span>ë§ì´</span>
                </div>

                <!-- ë‹¬ë ¥ ì•„ë˜ ìƒì„¸ ëª©ë¡ ì˜ì—­ (flex-1 ì œê±°í•˜ê³  ìì—°ìŠ¤ëŸ½ê²Œ ë†’ì´ ì°¨ì§€í•˜ë„ë¡ ìˆ˜ì •) -->
                <div class="bg-blue-50 rounded-2xl border border-blue-100 overflow-hidden min-h-[150px]">
                    <div class="p-3 bg-blue-100 border-b border-blue-200 flex items-center gap-2 sticky top-0">
                        <i class="fas fa-list-ul text-blue-500"></i>
                        <h3 class="text-sm font-bold text-gray-700 flex-1" id="monthly-list-title">ë‚ ì§œë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</h3>
                    </div>
                    <ul id="monthly-book-list" class="space-y-2 p-3">
                        <li class="text-gray-400 text-center text-sm flex flex-col items-center justify-center py-8">
                            <i class="fas fa-hand-pointer mb-2 text-2xl opacity-30"></i>
                            ë‹¬ë ¥ì˜ ë‚ ì§œë¥¼ ëˆ„ë¥´ë©´<br>ì—¬ê¸°ì— ì±… ëª©ë¡ì´ ë‚˜ì™€ìš”!
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¯¸ì…˜ ë‹¬ì„± ì¶•í•˜ ëª¨ë‹¬ -->
    <div id="celebration-modal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center shadow-2xl border-4 border-purple-300 animate-bounce relative">
            <div class="text-6xl mb-4">ğŸ§â€â™‚ï¸</div>
            <h2 class="text-3xl font-bold text-purple-600 mb-2">ì¶•í•˜í•©ë‹ˆë‹¤!!</h2>
            <p class="text-gray-600 text-lg mb-6">ë™ì „ <span id="celeb-count" class="font-bold text-red-500 text-2xl">50ê°œ</span>ë¥¼ ëª¨ì•˜ì–´ìš”!</p>
            
            <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-2xl border-2 border-purple-200 mb-6 transform rotate-1">
                <p class="font-bold text-purple-800 text-xl">ğŸ ì†Œì› ë“¤ì–´ì£¼ê¸° ì¿ í°</p>
                <p class="text-sm text-purple-600 mt-2">ë¶€ëª¨ë‹˜ê»˜ ì´ í™”ë©´ì„ ë³´ì—¬ë“œë¦¬ê³ <br>ì†Œì›ì„ ë§í•´ë³´ì„¸ìš”!</p>
            </div>

            <button onclick="closeCelebration()" class="w-full py-4 bg-purple-500 text-white rounded-xl font-bold text-lg shadow-lg hover:bg-purple-600 transition">ì•¼í˜¸! ì•Œê² ì–´ìš”!</button>
        </div>
    </div>

    <script>
        // --- ìƒíƒœ ê´€ë¦¬ ---
        let books = JSON.parse(localStorage.getItem('jaekyung_books_v3')) || [];
        let selectedDate = new Date();
        let calendarDate = new Date();
        let monthlySelectedDateStr = null;
        
        // --- ì´ˆê¸°í™” ---
        document.addEventListener('DOMContentLoaded', () => {
            const checkbox = document.getElementById('double-coin-check');
            if(checkbox) checkbox.checked = false;

            renderWeeklyCalendar();
            updateUI();
            updateDailyBookList();
        });

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function getFormattedDate(date) {
            const offset = date.getTimezoneOffset() * 60000;
            return (new Date(date - offset)).toISOString().split('T')[0];
        }

        function getBooksByDate(dateStr) {
            return books.filter(book => book.date === dateStr);
        }

        // --- ì£¼ê°„ ë‹¬ë ¥ ë Œë”ë§ ---
        function renderWeeklyCalendar() {
            const container = document.getElementById('weekly-calendar');
            container.innerHTML = '';

            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay()); 

            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const dateStr = getFormattedDate(date);
                const dayBooks = getBooksByDate(dateStr);

                const dayCol = document.createElement('div');
                dayCol.className = `flex-1 flex flex-col items-center p-1 rounded-2xl border-2 border-transparent transition cursor-pointer ${dateStr === getFormattedDate(selectedDate) ? 'date-active' : ''}`;
                dayCol.onclick = () => selectDate(date);

                const weekDays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                const dayLabel = document.createElement('div');
                dayLabel.className = `text-xs mb-1 ${i === 0 ? 'text-red-400' : (i === 6 ? 'text-blue-400' : 'text-gray-500')}`;
                dayLabel.innerText = weekDays[i];
                dayCol.appendChild(dayLabel);

                const dateLabel = document.createElement('div');
                dateLabel.className = 'text-lg font-medium text-gray-700 mb-2';
                dateLabel.innerText = date.getDate();
                dayCol.appendChild(dateLabel);

                const coinContainer = document.createElement('div');
                coinContainer.className = 'flex flex-col-reverse items-center h-24 w-full overflow-hidden pb-1';
                
                let coinCount = 0;
                dayBooks.forEach((book) => {
                    const value = book.coins || 1;
                    for(let c=0; c < value; c++) {
                        if (coinCount < 12) {
                            const coin = document.createElement('div');
                            coin.className = value === 2 ? 'coin special' : 'coin';
                            coinContainer.appendChild(coin);
                        }
                        coinCount++;
                    }
                });
                
                if (coinCount > 12) {
                     const more = document.createElement('div');
                     more.className = 'text-xs text-yellow-600 font-bold mt-1';
                     more.innerText = `+${coinCount - 12}`;
                     coinContainer.appendChild(more);
                }

                dayCol.appendChild(coinContainer);
                container.appendChild(dayCol);
            }
        }

        // --- ë‚ ì§œ ì„ íƒ ---
        function selectDate(date) {
            selectedDate = date;
            renderWeeklyCalendar();
            updateDailyBookList();
            
            const dateStr = getFormattedDate(date);
            const todayStr = getFormattedDate(new Date());
            const displayDate = dateStr === todayStr ? 'ì˜¤ëŠ˜' : `${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
            document.getElementById('selected-date-display').innerText = displayDate;
        }

        // --- ì±… ì €ì¥ ---
        function saveBook() {
            const input = document.getElementById('book-input');
            const checkbox = document.getElementById('double-coin-check');
            
            const title = input.value.trim();
            const isDouble = checkbox.checked === true;
            const coins = isDouble ? 2 : 1; 

            if (!title) { alert('ì±… ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

            const dateStr = getFormattedDate(selectedDate);
            books.push({ id: Date.now(), title: title, date: dateStr, coins: coins });
            localStorage.setItem('jaekyung_books_v3', JSON.stringify(books));

            input.value = '';
            checkbox.checked = false;
            
            renderWeeklyCalendar();
            updateUI();
            updateDailyBookList();
            checkMilestone();
            
            const msg = isDouble ? `ìš°ì™€! ì–´ë ¤ìš´ ì±…ì„ ì½ì—ˆë„¤! ë™ì „ 2ê°œ íšë“! ğŸª™ğŸª™` : `"${title}" ì €ê¸ˆ ì™„ë£Œ! ì°¸ ì˜í–ˆì–´!`;
            setMascotMessage(msg);
        }

        // --- ì±… ì‚­ì œ ---
        function deleteBook(id) {
            if(confirm('ì •ë§ ì´ ì±… ê¸°ë¡ì„ ì§€ìš¸ê¹Œìš”?')) {
                books = books.filter(book => book.id !== id);
                localStorage.setItem('jaekyung_books_v3', JSON.stringify(books));
                
                renderWeeklyCalendar();
                updateUI();
                updateDailyBookList();
                setMascotMessage('ì±… ê¸°ë¡ì„ ì§€ì› ì–´. ë‹¤ì‹œ ì½ê³  ê¸°ë¡í•´ë³´ì!');
                
                // ì›”ê°„ ë‹¬ë ¥ì´ ì—´ë ¤ìˆë‹¤ë©´ ê°±ì‹ 
                if(!document.getElementById('monthly-calendar-modal').classList.contains('hidden') && monthlySelectedDateStr) {
                    const [y, m, d] = monthlySelectedDateStr.split('-').map(Number);
                    selectMonthlyDate(y, m-1, d); // ê°±ì‹ 
                }
            }
        }

        // --- ì¼ì¼ ì±… ëª©ë¡ ì—…ë°ì´íŠ¸ ---
        function updateDailyBookList() {
            const listContainer = document.getElementById('daily-book-list');
            const dateStr = getFormattedDate(selectedDate);
            const dayBooks = getBooksByDate(dateStr);

            listContainer.innerHTML = '';
            if (dayBooks.length === 0) {
                listContainer.innerHTML = '<li class="text-gray-400 text-center py-4">ì•„ì§ ê¸°ë¡ëœ ì±…ì´ ì—†ì–´ìš”.</li>';
            } else {
                dayBooks.forEach(book => {
                    const li = document.createElement('li');
                    li.className = 'bg-white p-2 rounded-lg border border-gray-100 flex items-center justify-between gap-2 group hover:bg-gray-50 transition';
                    // ìˆ˜ì •ë¨: font-bold ì œê±°
                    const coinBadge = (book.coins === 2) 
                        ? '<span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full whitespace-nowrap">ë™ì „x2</span>' 
                        : '<span class="text-xs bg-yellow-100 text-yellow-600 px-2 py-1 rounded-full whitespace-nowrap">ë™ì „x1</span>';
                    
                    li.innerHTML = `
                        <div class="flex items-center gap-2 truncate flex-1">
                            <i class="fas fa-book text-blue-300 shrink-0"></i>
                            <span class="truncate text-sm font-medium text-gray-700">${book.title}</span>
                        </div>
                        <div class="flex items-center gap-2 shrink-0">
                            ${coinBadge}
                            <button onclick="deleteBook(${book.id})" class="text-gray-300 hover:text-red-500 w-6 h-6 flex items-center justify-center rounded-full hover:bg-red-50 transition" title="ì‚­ì œ">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    listContainer.appendChild(li);
                });
            }
        }

        // --- UI ì „ì²´ ì—…ë°ì´íŠ¸ ---
        function updateUI() {
            const totalCoins = books.reduce((sum, book) => sum + (book.coins || 1), 0);
            document.getElementById('total-books').innerText = totalCoins;
            const nextGoal = Math.ceil((totalCoins + 1) / 50) * 50;
            document.getElementById('next-goal').innerText = nextGoal - totalCoins;
        }

        // --- ì›”ê°„ ë‹¬ë ¥ ê´€ë ¨ í•¨ìˆ˜ ---
        function openMonthlyCalendar() {
            calendarDate = new Date(selectedDate);
            monthlySelectedDateStr = null;
            renderMonthlyCalendar();
            
            // ëª©ë¡ ì´ˆê¸°í™”
            document.getElementById('monthly-list-title').innerText = "ë‚ ì§œë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!";
            document.getElementById('monthly-book-list').innerHTML = `
                <li class="text-gray-400 text-center text-sm flex flex-col items-center justify-center py-8">
                    <i class="fas fa-hand-pointer mb-2 text-2xl opacity-30"></i>
                    ë‹¬ë ¥ì˜ ë‚ ì§œë¥¼ ëˆ„ë¥´ë©´<br>ì—¬ê¸°ì— ì±… ëª©ë¡ì´ ë‚˜ì™€ìš”!
                </li>`;
            
            document.getElementById('monthly-calendar-modal').classList.remove('hidden');
        }
        function closeMonthlyCalendar() {
            document.getElementById('monthly-calendar-modal').classList.add('hidden');
        }
        function changeMonth(delta) {
            calendarDate.setMonth(calendarDate.getMonth() + delta);
            renderMonthlyCalendar();
        }

        function selectMonthlyDate(year, month, day) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            monthlySelectedDateStr = dateStr;
            renderMonthlyCalendar();
            
            // ëª©ë¡ ì—…ë°ì´íŠ¸
            const listTitle = document.getElementById('monthly-list-title');
            const listContainer = document.getElementById('monthly-book-list');
            const dayBooks = getBooksByDate(dateStr);
            
            // ìˆ˜ì •ë¨: font-bold ì œê±°
            listTitle.innerHTML = `<span class="text-blue-600 font-medium">${month + 1}ì›” ${day}ì¼</span> ì½ì€ ì±… (${dayBooks.length}ê¶Œ)`;
            
            listContainer.innerHTML = '';
            if (dayBooks.length === 0) {
                listContainer.innerHTML = `
                    <li class="text-gray-400 text-center text-sm flex flex-col items-center justify-center py-8">
                        <i class="fas fa-book-open mb-2 text-2xl opacity-30"></i>
                        ì´ ë‚ ì€ ì½ì€ ì±…ì´ ì—†ì–´ìš”.
                    </li>`;
            } else {
                dayBooks.forEach(book => {
                    const li = document.createElement('li');
                    li.className = 'bg-white p-3 rounded-xl border border-blue-100 shadow-sm flex items-center justify-between gap-2';
                    // ìˆ˜ì •ë¨: font-bold ì œê±°
                    const coinBadge = (book.coins === 2) 
                        ? '<span class="text-[10px] bg-orange-100 text-orange-600 px-1.5 py-0.5 rounded-full whitespace-nowrap">x2</span>' 
                        : '<span class="text-[10px] bg-yellow-100 text-yellow-600 px-1.5 py-0.5 rounded-full whitespace-nowrap">x1</span>';
                    
                    li.innerHTML = `
                        <div class="flex items-center gap-2 truncate text-gray-700 font-medium">
                            <i class="fas fa-book text-blue-300 text-xs"></i>
                            ${book.title}
                        </div>
                        <div class="flex items-center gap-1">
                            ${coinBadge}
                             <button onclick="deleteBook(${book.id})" class="text-gray-300 hover:text-red-500 w-6 h-6 flex items-center justify-center rounded-full hover:bg-red-50 transition" title="ì‚­ì œ">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    listContainer.appendChild(li);
                });
            }
        }

        function renderMonthlyCalendar() {
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            document.getElementById('calendar-title').innerText = `${year}ë…„ ${month + 1}ì›”`;

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const grid = document.getElementById('calendar-days');
            grid.innerHTML = '';

            for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div'));

            for (let d = 1; d <= lastDate; d++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const count = getBooksByDate(dateStr).reduce((sum, book) => sum + (book.coins || 1), 0);
                
                const cell = document.createElement('div');
                
                let bgClass = 'bg-white hover:bg-gray-50';
                let textClass = 'text-gray-600';
                let borderClass = 'border-gray-200';

                if (count >= 1) { bgClass = 'bg-yellow-100'; borderClass = 'border-yellow-200'; }
                if (count >= 3) { bgClass = 'bg-yellow-200'; borderClass = 'border-yellow-300'; }
                if (count >= 5) { bgClass = 'bg-yellow-300'; borderClass = 'border-yellow-400'; textClass = 'font-bold'; }
                if (count >= 7) { bgClass = 'bg-yellow-400'; borderClass = 'border-yellow-500'; textClass = 'text-white font-bold'; }
                
                if (monthlySelectedDateStr === dateStr) {
                    borderClass = 'border-blue-500 border-2';
                    bgClass = 'bg-blue-50';
                    textClass = 'text-blue-600 font-bold';
                }

                cell.className = `aspect-square rounded-lg border ${borderClass} ${bgClass} ${textClass} flex items-center justify-center text-sm transition relative cursor-pointer transform hover:scale-105`;
                cell.innerText = d;
                cell.onclick = () => selectMonthlyDate(year, month, d);
                
                grid.appendChild(cell);
            }
        }

        // --- ë§ˆìŠ¤ì½”íŠ¸ ë° ë¯¸ì…˜ ---
        function setMascotMessage(msg) {
            const el = document.getElementById('mascot-message');
            el.innerText = msg;
            el.parentElement.classList.remove('animate-bounce');
            void el.parentElement.offsetWidth;
            el.parentElement.classList.add('animate-bounce');
        }
        
        function checkMilestone() {
            const totalCoins = books.reduce((sum, book) => sum + (book.coins || 1), 0);
            if (totalCoins > 0 && totalCoins % 50 === 0) {
                document.getElementById('celeb-count').innerText = totalCoins + "ê°œ";
                document.getElementById('celebration-modal').classList.remove('hidden');
                fireConfetti();
            }
        }
        
        function closeCelebration() {
            document.getElementById('celebration-modal').classList.add('hidden');
        }
        
        function fireConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) { return clearInterval(interval); }
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: 0.1, y: 0.6 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: 0.9, y: 0.6 } }));
            }, 250);
        }
    </script>
</body>
</html>
